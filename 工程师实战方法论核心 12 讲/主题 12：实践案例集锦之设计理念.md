## 主题 12：实践案例集锦之设计理念

### 1. 引言

> 古语云：道为术之灵，术为道之体；以道统术，以术得道。

其中：“道”指“规律、道理、理论”，“术”指“方法、技巧、技术”。意思是：“道”是“术”的灵魂，“术”是“道”的肉体；可以用“道”来统管“术”，也可以从“术”中获得“道”。工匠追求“术”到极致，其实就是在寻“道”，且离悟“道”也就不远了，亦或是已经得道，这就是“工匠精神”——一种追求“以术得道”的精神。如果一个工匠只满足于“术”，不能追求“术”到极致去悟“道”，那只是一个靠“术”养家糊口的工匠而已。

作为《工程师实战方法论核心 12 讲》专栏的最后一篇文章，笔者不打算介绍一个具体的案例（术），而将介绍一些从实践中总结而来的设计理念，勉强算是“道”吧。如果你已经阅读至此，那么不妨继续阅读，有始有终，相信定会有所收获。

### 2. 设计理念

#### **2.1 自上而下设计，自下而上验证**

提到软件设计，很多工程师可能会想到一幅幅结构清晰的架构图，以为关于软件架构的所有奥秘都隐藏在图里，但经历过一些项目后发现，这往往是不够的。Jack Reeves 在《源代码即设计》一文中提出一个观点，笔者深以为然，在此引用如下：

> 高层结构的设计不是完整的软件设计，它只是细节设计的一个结构框架。在严格地验证高层设计方面，我们的能力是非常有限的。详细设计最终会对高层设计造成的影响至少和其它的因素一样多（或者应该允许这种影响）。对设计的各个方面进行改进，是一个应该贯穿整个设计周期的过程。

在踩过一些坑之后，这种强调详细设计重要性的观点在笔者看来很实在、接地气，简单来说：“自顶向下的设计通常是不完善的，编码本身也是设计过程的一部分”，个人认为：系统设计应该是自上而下设计，自下而上验证，如是反复，不断演化而得到良好的设计。

#### **2.2 架构之前，须明确主要矛盾**

> 花半秒钟就看透事物本质的人，和花一辈子都看不清事物本质的人，注定是截然不同的命运。——电影《教父》

事物的发展过程中存在着自始至终的矛盾运动，每一个事物都有主要矛盾与次要矛盾。矛盾权衡是一个问题，解决主要矛盾，一切问题就迎刃而结解了。在做架构前，需要明确一些架构理念，具体而言：

1. 满足业务发展的需求是最高准则；
2. 业务抽象、建模，需要平衡，不能走极端；
3. 模型要能更真实地反映事物的本质，不是名词概念的堆砌，不能过度设计；
4. 基础架构最关键的是分离不同业务领域、不同技术领域，让整个系统具有持续优化的能力；
5. 分离基础服务、业务规则、业务流程，选择合适的工具外化业务规则和业务流程；
6. 分离业务组件和技术组件，高内聚、低耦合，业务信息的执行可以分散，但业务信息的管理要尽量集中；
7. 不要让软件的逻辑架构与物理部署绑死；
8. 选择合适的技术而不是高深的技术，随着业务的发展调整使用的技术；

#### **2.3 开发规约，应普遍认可**

无规矩不成方圆，一个大的团队/部门/公司，如果没有统一的规约，工程师各行其是，往往会导致非常糟糕的局面。以 Java 为例，阿里推出的《Java 开发规约》广受好评，这一规约制定的背后是阿里曾面临的困境——不同部门工程结构、代码风格迥异，规范不一，沟通、维护成本高，合作效率低。

在实践中，规约设计应遵循一些理念：对软件来说，开发规约绝不是消灭代码内容的创造性、优雅性，而是限制过度个性化，推行相对标准化，以一种普遍认可的方式规范开发。前车之鉴，后事之师，在工程实践中积累的大量历史故障数据是很好的借鉴之源，将其归纳总结为规约以避免重蹈覆辙是非常实用的规约制定策略。

同时，规约应力求让它的遵循者知其然并知其所以然，定位为轻松的双向约定，而非冰冷的文书，以开发的视角，结合正反例和历史故障数据分析。良好的规约有利于提高程序的可读性、可维护性、可复用性，切实提高软件产品质量。

#### **2.4 业界风潮，拥抱而不拘泥**

> 弱小和无知不是生存的障碍，傲慢才是。

最近几年，中台是一个非常特殊的存在。对技术人来说，对中台的感情非常复杂，某种意义上就是最熟悉的陌生人。从民间到学界，人人都在谈中台，但好像人人都没法说清楚。有人说中台长得像鸭，有人说中台长得像鸡，有人说中台两条腿，有人说中台四条腿。盲人摸象，各执一词，管中窥豹，一知半解，各种怪现状此起彼伏。

中台有多特殊？中台（Zhong Tai）是唯一一个中国原创的企业数字化建设的概念，这一次，中国不再是西方的追随者。但是，早在 2015 年就提出的中台概念，至今仍未出台相关标准，甚至在中台的定义方面都无法达成共识，什么是中台？如何建设中台？众说纷纭，莫衷一是。中台概念在过去的五年中一度高光，火遍国内技术圈，但似乎鲜有见到建设中台非常成功的案例，这是值得反思的。

在笔者看来，并不是所有公司都有必要建设中台，大部分中小公司，业务跨度没那么大，复杂度也不高，并没有很大必要建设中台。这种阶段的公司，能做到**复用技术能力**就足够了，强行引入中台并不一定能提升效率。同时，从建设中台的成本来看，对于大多数公司来说都是不低的，这是一个经济问题，现在还没有什么低成本建设成功中台的最佳实践。大多数小公司听说中台实施团队的报价和工期，就退却了。须知，中台是用来解决业务团队提效的问题的，中台不是万金油，中台不是灵丹妙药。

在任何一个相对成熟的领域，通常都有几个体量非常大的公司占据着主要市场份额，为了提高后来者进入市场的门槛，防止其打破现有的利益布局，头部企业会往往联合起来成立各种组织，建立起各种行业标准和规范。这些规范里面会包含本行业的一些最佳实践，作为后来者，遵循这些最佳实践是有必要的，它可以帮助我们少踩坑，但需要注意的是，最佳实践往往也有其局限性。实践中，在充分借鉴最佳实践的前提下，应根据自身的情况具体分析，必要的时候，要放弃、重塑甚至推翻既往的“最佳实践”。

#### **2.5 少即是多，过犹不及**

> 同大多数学科一样，学习编程的艺术首先要学会基本的规则，然后才能知道什么时候可以打破这些规则。——*Effective Java* 的作者 Joshua Bloch

在我们学习并初步掌握一些知识的时候，一旦有机会便跃跃欲试，急切地试图将所学落地，甚至不惜生搬硬套。这并不是一种好的方式，比如，面向接口编程很好，但不应该不分背景、不分场合地使用，因为过多的使用接口，过多的引入间接层也会带来一些不必要的复杂度。笔者曾见过一些内部模块设计得过于“灵活”的应用，给什么 DAO、Convertor 都加上一层 Interface，但实际情况是，应用中对 DAO、Convertor 的实现进行替换的可能性极低。类似于这种装模作样，装腔作势的 Interface 完全是没有意义的。

没有最好的设计，只有最合适的设计。在实践中，工程师应避免不必要的“炫技”，特别是在自身尚未深刻理解某种技法的时候，少即是多，凡事过犹不及。

#### **2.6 发展传承，文档即代码**

纵观计算机发展历史，软件研发效率提升就是弥合现实世界和计算机二进制世界的鸿沟。从二进制编码到汇编，到 C 语言，到面向对象的 C++、Java。每一次升级都是用人类更容易理解的方式抽象描述现实世界，然后通过一个编译程序无差异的翻译成低阶的、计算机能直接运行的二进制。我们最核心的资产是编译前的源代码，而不是编译后可运行的二进制代码。因为我们编译后的代码不容易理解，也不可能通过逆向工程还原出源代码。丢掉了源代码，基本上就失去了所有。

我们所做的需求分析、概要设计、详细设计到最后的代码，其本质就是**现实世界**到**计算机世界**的一次编译过程。这其中最大的问题是“人肉编译”，与机器的无差别编译不同，“人肉编译”过程因人而异。因为这种不确定性，导致所设计文档随着时间的推移，与实际运行的代码之间往往会产生不可弥合的鸿沟。一个业务系统的文档越来越没有用处，也就越来越没人写了。

近年来，“敏捷开发”风行后，一些工程师提出“去文档化”，笔者认为这是矫枉过正，文档看上去可能不那么“敏捷”，但对于一个庞大的系统，在其发展、传承的过程中，文档仍是非常重要的信息介质。试想，一个百万行代码的应用，如果没有文档，仅仅通过代码去探究，无异于盲人摸象。

在实践中，我们需要把**设计和实现融合**在一起，实现**文档即代码**，产出并维护真实可用的文档。当然，凡事过犹不及，不要为写文档而写文档，须知，不存在独立于可执行系统之外的文档，所有的信息都蕴含在系统之中，只是通过一些工具（如文档）进行可视化、具像化，增强可读性。

### 3. 总结

本文是《工程师实战方法论核心 12 讲》专栏的最后一篇文章，这应该也是笔者一段时期内的最后一篇文章。

> 古语有云：有道无术，术尚可求也；有术无道，止于术。

意思是：有“道”而无“术”，“术”还可以逐渐获得；有“术”而无“道”，就可能止步于“术”了。所以，我们不要仅满足于从实践中总结“术”，因为“道”的表现形式是多变的；而应该上升到“道”的高度，因为“术”背后的道理是相通的。当遇到新的事物时，我们可以从理论中找到“道”、从实践中找出“术”，尝试着去认知新的事物。

### 4. 后记

你能耐心地阅读至此，相信一定是对技术感兴趣的，如果你已经具有两年以上工作经验，并且熟悉 Java 技术栈、数据分析、推荐算法、软件测试等相关领域中的任意一个，那么，不妨考虑一下加入阿里系，与我们一道“行走江湖”。阿里系（包括集团、阿里云、蚂蚁金服、菜鸟网络、钉钉、天猫等）长期招聘 Java 技术栈工程师、算法工程师、前端工程师、测试工程师等。

如果你有意向，请将简历和所应聘的岗位发送到邮箱：**guojin.gj@antfin.com**，在评估后，**直接内推**。如果你对应聘阿里的岗位选择、简历制作、面试等事项不清楚，不妨看一下这两篇文章《[谈谈应聘阿里全流程](https://gitbook.cn/gitchat/activity/5c66e8fc586c783fc9e7d0b7)》和《[前车之鉴：从被回绝的系列原因出发，解读应聘阿里的注意事项](https://gitbook.cn/gitchat/activity/5cbc82ddced2637d6fc8dba7)》。

If not now, When? If not you, Who? 如果你决定改变，就不要在犹豫中错失良机。