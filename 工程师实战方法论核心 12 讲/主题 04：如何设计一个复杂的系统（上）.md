## 主题 04：如何设计一个复杂的系统（上）

### 1. 引言

系统设计又称系统架构，软件领域负责系统设计的工程师通常被称为架构师。在阿里，架构师多以角色存在于具体的项目中，而非专门设置的职位，对于复杂的系统，通常由 P8 或 P9 级别的资深工程师负责设计。

在实践中，根据复杂度的不同，有些小系统只需画个流程图即可梳理清楚；但是，复杂系统的设计则困难得多，以 12306 为例，2020 年春运期间高峰日点击量达 1495 亿/天，170 万/秒，单从这两个数据看，其设计、实现就不容易。在 12306 系统设计方案评审的时候，官方曾邀请了数名阿里的资深工程师参与，本主题的撰稿人之一便是当年的亲历者，在通过官方提供的资料详细地了解了铁路交通票务相关的信息后，他才意识到自己严重低估了铁路票务的复杂度。在此，读者不妨设想一下，如果你是 12306 项目的设计师，你准备如何设计这个系统呢？你的设计套路（方法）是怎样的？

在笔者看来，不论采用何种设计方案，首先需要明确一个问题——你了解铁路票务吗？如果根本不了解铁路票务，那么，又怎么可能设计出满足铁路票务业务需求的系统呢？在实践中，设计一个复杂的系统，并不单纯是技术层面的问题，首要任务是深入了解其业务，鉴于此，作为系统设计主题的上篇，本文将重点介绍工程师如何践行技术与业务同行。

### 2. 了解业务十分重要

工程师大多在技术领域是很有追求的，但却普遍轻视业务，甚至嗤之以鼻。这种现象多与工程师的职场经历相关：大多数工程师是和产品经理沟通需求，而不是直接与真正的业务方沟通，导致很多工程师不了解业务全貌；同时，工程师专注于技术，为各种需求所累，业务意识淡漠，更不会主动去思考业务痛点和了解业务策略。笔者在阿里的前两年做的是比较偏中台技术的工作，对业务感知比较少，也不感兴趣，那时候比较崇拜技术大牛，根本没有意识去了解业务相关的信息。现在回想起来，当初还是格局不足，视野局限。

在互联网领域，特别是在阿里、腾讯这类商业科技公司，一个不理解业务的工程师，和流水线的工人是没有很大区别的。在阿里，工程师晋升答辩技分为三大板块：业务理解、项目管理和专业技术，其中业务理解是非常重要的，层级越高，业务理解的占比越大。一个不懂业务、不了解业务的工程师，很难设计出好的系统。比如 12306 这样的系统，如果不了解它的业务，何谈设计？它的业务有多复杂呢？在此，单就其 SKU 来分析。

**SKU 总数多**

对于普通商品，一个 SKU 对应一种商品，每卖出一件，库存减一；而列车票则是一种动态 SKU——以上海到成都的 G1974 为例，共有 20 个站、三种座位，粗略一看似乎只有三种 SKU（商务座、一等座、二等座），实际上 G1974 有 570 个SKU，始发站上海与后面的 19 个站便有 19x3 个 SKU，以此类推共计 (19+18+17+…+1)x3=570 个 SKU。

**SKU 计算复杂**

为什么计算复杂呢？G1974 总共有 570 个 SKU，但是 SKU 的数量和库存却都是动态的，库存不仅会减少，还会增加。比如列车驶出上海站，SKU 会减少 19x3 个，对应的库存也会清零；与此同时，上海与第三站及其后面的站对应的 18x3 个 SKU 可能未卖完，这些座位自然不会浪费，因此，第二站苏州北到后面各站的 SKU 库存则可能会增加。如果再考虑座位存在位置差异（A、B、C、D、F），计算量会更大。

铁路交通领域的票务系统非常复杂，在系统设计之前，首先需要对铁路交通领域的业务进行充分地调研，深刻理解业务场景和运作模式，在此前提下，再谈设计。

通过上面的叙述，相信读者对于业务的重要性应该没有争议了。事实上，一个公司通常也是先有业务模式，再才去招兵买马，组建研发团队的，皮之不存毛将焉附。业务发展的好坏往往决定了公司的营收和前途，也决定了研发的效益和去留，因此工程师的首要任务是把业务支持好，在此前提下，再来谈技术沉淀和技术红利。

### 3. 技术与业务同行

根据工程师对业务的影响程度，可划分 6 个阶段，如下图所示，层层递进，越往上对业务的影响越大。在具体的业务中，不论是做前端开发、服务端开发，还是质量保障，最终目标都是促进业务发展，只是担当的角色不同，影响程度不同。工程师在打磨技术的同时应赋能业务，促进业务发展，这样可以让技术的价值得以更好地体现。

![在这里插入图片描述](https://images.gitbook.cn/87521630-6052-11ea-ada6-a35ea24e6ce6)

凡事无绝对！不理解业务、不参与业务决策，专注于技术领域（质量、稳定、体验、性能等）是不是就没有前途了呢？当然不是！我的一些同学在华为、阿里云、微软做偏底层的技术研发，同样发展得很好，他们对业务关注比较少，但是通过技术革新间接改善业务，也取得了一些很好的结果。企业对人才的需求是多样化的，每个人的特质不一样，有的人善于专研技术，有的人善于做串联协调，有的人善于做产品，业务理解和业务结果不是唯一衡量研发或人才的指标。但是有一点是可以肯定的：理解业务，有助于做技术决策去驱动业务，有助于对资源的优先级做判断，同时还有助于提升研发效能。回归主题，对于负责系统设计的工程师而言，理解业务则是必须的。

### 4. 如何理解业务

#### **4.1 需求不是业务**

很多工程师认为理解需求就是理解业务，这是一种误解。需求其实是业务经过产品消化后的产物，通常已经经过演绎和拆解，因此需求并不是业务本身，当然了解的需求越多，有助于清楚业务的全貌。那么，什么是业务呢？业界对"业务"有多种定义，但其主要思想基本一致：业务是指商业（或非商业）组织及其运作的活动流程，直白点就是一系列人通过一系列活动完成某一任务的过程。业务可大可小可拆分，比如支付宝的支付业务，往下可拆分为花呗、余额宝、银行卡等。

#### **4.2 业务三问**

在接触一个新业务时，技术人需要明确 3 个问题：

- 第一，这个业务的用户是谁？
- 第二，这个业务解决了什么痛点？
- 第三，这个业务为什么可以做？

在此，以**线上打车业务**为例具体说明。

**业务的参与者有哪些？**

要理解业务，首先要理解业务的参与者，或者说角色，他们在干什么，为何而来，到何处去，获得何种收益。在线上打车业务中，参与者有司机（包括社会车辆和营运车辆）、乘客和平台。

**业务解决了什么痛点？**

从司机的角度，可以帮助司机充分利用闲置时间去赚钱，同时可以接到更多的订单。从乘客的角度，线上打车比直接在路边打车高效，线上打车可以充分利用附近的车辆资源，还可以预约。简而言之，线上打车可以极大地提高社会效率，解决打车难这一社会痛点。

**为什么要做这个业务？**

明确了前面两点，再来分析一下为什么这个业务可以做：

1. 商业模式，流量如何来的？内容如何来的？生态情况怎么样？如何商业化的？
2. 竞对情况，行业现状如何？竞争对手怎么样？
3. 产品和技术，这个业务由什么产品来承载，对技术主要的依赖和诉求是什么；
4. 洞察与思考，这个业务有哪些技术关键点？解决方案（不涉及细节）与成本是怎样的？

明确了上面这些问题，便可对业务形成比较清晰的脉络，也就能和业务方对话了。在实践中，要达到这种程度并非易事，有些业务比较简单，比如打车，很容易明白业务框架，但是要了解细节也不容易，比如你知道出租车与出租车公司的关系和利益是怎样的吗？如果不理解，怎么去颠覆它？对于零售、贸易、制造、跨境、金融等更复杂的业务，就更难了解流程和细节了，需要借助各种渠道去补齐信息，比如阅读行业书籍、实地走访、与用户沟通、分析数据等方式。

### 5. 业务学习实践

在互联网企业工作多年，我的感触是：没有一个普适性方法放在任何一个具体的场景都可以绝对奏效。即便如此，仍然有一些普遍适用的学习步骤可供参考。

#### **5.1 理清业务知识框架**

对于未知的业务领域，可以通过阅读、交流、思考和实践快速形成业务知识框架。在阅读学习中，养成做笔记的习惯，整理业务领域知识、行业解决方案、竞品等相关信息，同时记录自己对业务的理解和不清楚的问题。新的认知往往来自交流和实践，在阅读学习的基础上，带着阅读时积攒的问题，与 PD、客户、BI 等交流，了解业务的主要参与者及其关联；与业务相关团队交流业务经验和技术规划；之后，体验竞品进一步熟悉业务领域。当然，在具体的场景中可能缺乏交流、学习的资源，需要我们灵活应对。

罗马不是一天建成的，业务的发展也不是。每个业务都有其发展周期，不管是高速发展中的业务，还是处于瓶颈期的业务，都是由于过去客观的市场因素加主观的策略走到了当下。欲深刻理解业务，还需了解业务的过去，不管是爆发式增长还是萎靡不前，一定有其背后的原因，可以作为未来前进的参考。了解过去，看到未来，才能做好当下。在此，以外贸业务为例，通过上面的过程，可以初步整理出大致的业务知识框架：

![在这里插入图片描述](https://images.gitbook.cn/345329d0-605a-11ea-974c-2bc8ec103edb)

#### **5.2 从客户出发梳理业务主链路**

理清业务的大致框架后，再从客户的角度切入，进一步梳理业务链路。在梳理的过程中，需要明确几个问题：客户的主要需求有哪些？痛点是什么？在业务链路中，我们可以为客户提供哪些服务？在此基础上，调研业务未来的发展方向。这里仍以外贸业务为例，梳理业务主链路如下图所示：

![在这里插入图片描述](https://images.gitbook.cn/9308acb0-6079-11ea-8710-d9de95ee7855)

外贸业务相对复杂，一票货物需要经过头程运输、国内报关、干线运输、目的国清关、尾程运输才能到达买家手中。这中间客户存在大量痛点，比如信息在不同服务商之间流转不顺畅、物流时效、物流运输成本、专业领域的服务问题等；此外还需对接其它外贸行业玩家，比如货代、报关行、拖车行等。

#### **5.3 业务主链路重要节点展开**

在完成业务主链路梳理之后，应进一步对主链路中的重要节点进行展开，丰富细节，完成这一步才算真正完成业务的梳理。在此，仍然以外贸业务为例，就客户接入外贸服务平台的准入流程展开，如下图所示：

![在这里插入图片描述](https://images.gitbook.cn/f5a1e650-6080-11ea-8710-d9de95ee7855)

#### **5.4 将业务与技术联系起来**

上面三个步骤均聚焦于业务，从整体到局部，自上而下，逐步细化。经过这三步，可对业务形成较为充分的认知，接下来，需要将业务和技术联系起来，不要忘了我们了解业务的终极目标——设计一个能够满足业务需求的系统。

需要特别注意的是，此处不应该涉及技术细节，而是从业务的角度出发分析——为了赋能业务，从技术的角度看需要提供哪些技术能力。在此，笔者以较为复杂的旅行业务（如携程、飞猪、去哪儿）为例，探索技术如何赋能业务，如下图所示：

![在这里插入图片描述](https://images.gitbook.cn/a3ac3a50-608d-11ea-974c-2bc8ec103edb)

### 6. 总结

几乎没有一项技术能够脱离业务而孤独的存在，即便是军工领域，在和平年代军事需求不足的情况下，也倡导“军民融合”，用军工技术赋能民用场景，以此反哺技术。在互联网领域，以用户为基础的业务场景通常都较为复杂，充分理解业务是设计好系统的前提，因此，负责系统设计的工程师必须重视业务、充分理解业务。

本文是“如何设计一个复杂的系统”主题的上篇，着力于阐明理解业务的重要性，以及学习、理解业务的方法。与此同时，针对“如何设计一个复杂的系统”这一问题，给出了第一个回答：首先理解业务！在下一篇文章中，将进一步解读。

**致谢：感谢樵枫、伐薪对本文的贡献。**