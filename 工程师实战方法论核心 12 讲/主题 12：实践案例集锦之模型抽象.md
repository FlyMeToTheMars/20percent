## 主题 12：实践案例集锦之模型抽象

### 1. 引言

模型是一种将事物形象化的有效手段，利用模型可将现实世界中的事物及事物之间的关系准确地表达出来。模型设计本质上就是系统地实施抽象的过程。

很多时候，工程师面对的需求都是以具象的现实世界事物概念来描述的，遵循的是人类世界的语境。为了将需求落地，工程师需要开展一系列的工作，其中模型设计尤为重要。模型设计的过程是一个从整体到局部、从高层模型设计到细节逐步细化的过程。在《主题 03：如何设计模型》一文中，将模型设计过程分为：概念分析、逻辑设计、物理设计三个阶段。本文将以会员权益为例，带领读者感受模型设计的过程。

### 2. 会员权益举例

在互联网领域，通过会员体系提升用户忠诚度是比较常用的手段，如下所示，分别是招商银行、支付宝、淘宝的会员页面。在会员体系中，积分和权益是最为重要的两个锚点，以支付宝为例，用户通过支付宝付款可以获得积分奖励，而积分又可以用于兑换权益，以此激励用户更多地使用支付宝，形成良性循环。

![在这里插入图片描述](https://images.gitbook.cn/c497b340-77ba-11ea-a3f1-b7b0a6636d71)

### 3. 概念模型分析

概念模型是从业务的视角对业务运营过程中涉及的信息进行结构化描述，是高层次的粗粒度模型，是对现实世界问题的 IT 表达；它是不包含设计实现细节的设计模型，通过对关键的实体、关系、规则的描述定义关键业务概念，确定业务概念的关键属性及其值域；某种意义上，概念模型是一种分析模型。

如下图所示，为两个会员权益，左边的是虚拟权益，右边的为实物权益，这两种类型是目前最为常见的权益类型。接下来，笔者将基于会员权益进行概念模型分析。

![在这里插入图片描述](https://images.gitbook.cn/050f7ac0-77e8-11ea-82ab-e5e139c28a1e)

#### **3.1 提取业务范围和概念**

总体来看，会员权益涉及的业务是非常多的：

- 权益的来源，采购 or 赞助，采购涉及财务，赞助则涉及合作商。
- 权益的生命周期，运营（配置、上线、下线以及库存管理），审核（财务）。
- 权益兑换与核销，用户（兑换、使用权益），财务（核销权益）。
- 权益的类型，虚拟权益比较简单，以券的形式存在；实物权益则还涉及物流。
- 权益的呈现，是否需要“千人千面”？换言之，是否需要接入推荐？

通过上面的分析，业务领域涉及权益采购、运营、物流、核销、推荐等。其中名词“用户”、“运营”、“财务”、“合作商”等为业务活动的参与者（承载者）。

#### **3.2 获取业务活动**

列出业务层面的事件列表，将业务处理活动逐层的进行分解，一个业务领域为了实现一个目标，需要有多个业务活动进行支撑，而每个业务活动又需要多个子活动进行支撑。自上而下是活动的分解过程，业务活动的分析可以是一步到位的，也可以是逐步完善的。

基于前面的分析，会员权益涉及的业务活动非常多，在此，笔者以**权益的生命周期**为例分析业务活动，业务层面涉及的事件有：权益配置、权益审核、权益上线、权益下线以及权益运维，这些事件都是**权益的生命周期**相关的事件（活动），如下图所示：

![在这里插入图片描述](https://images.gitbook.cn/0f78de50-77ef-11ea-b760-29671afaaa1a)

#### **3.3 模型推导**

根据实体之间的从属关系画出静态关系，将活动展开画出 ERD。首先，我们将业务事件（活动）和实体（活动参与者）的关系图整理出来，如下所示：

![在这里插入图片描述](https://images.gitbook.cn/b04fb470-7803-11ea-8e11-89f2c26dd0be)

在上图的基础上，进一步整理出 ERD 图，如下所示：其中，权益和操作记录是我们要分析的模型，图中列举了部分关键属性；运营和财务则是已有模型（对于一个公司来说，运营和财务都是员工，其模型应是现成的）。

![在这里插入图片描述](https://images.gitbook.cn/b469c600-7802-11ea-82ab-e5e139c28a1e)

### 4. 逻辑模型设计

逻辑模型设计是在概念模型设计的基础上扩展和细化形成的解决方案视角的模型。逻辑模型重在设计，而概念模型重在分析。

逻辑阶段设计的目标是设计支持现实世界概念模型的逻辑模式和子模式，并将概念模型转换为存储所支持的数据模型。在该过程中需要对概念分析阶段所涉及的业务进行逐步细化，以达到能在系统中实现的程度。为此，需要从业务功能中抽象出处理功能，并且对实体和处理进行归纳抽象，并且在分析数据流程时，要表达出具体数据的流向。

#### **4.1 理清边界**

就会员权益而言，应去掉概念模型分析阶段出现的运营和财务两个实体，毕竟这两个实体已经存在，无需再分析。

#### **4.2 归纳与细化**

对于实体进行完善、细化和抽象。将模型中相近的实体进行归纳抽象，消除冗余，从信息实体中提取出数据实体；抽象是一个由多到少的过程，目的是要达到模型与业务的无关性，实现数据模型的稳定持续发展。抽象过程中属性和值域需做相应整合。引入设计层面所需要的实体，然后对系统开展的活动进一步细化，使得处理功能越来越逼近于函数的实现形式；细化是一个由少到多的过程，细化的目标是完善实体和功能。细化过程中需补充完整属性和值域。

1. 就会员权益而言，在生命周期中涉及的很多事件（如配置修改、库存变更等）不应该在权益配置上直接操作，而应该在其副本上操作，副本经过验证、审核后再覆盖掉原配置，如此可以降低操作风险。
2. 权益分属不同类目，如美食、影音、红包、酒店、出行等，因此，须增加属性 catCode；
3. 权益有效期，开始/结束时间，增加 startDate 和 endDate 属性；
4. 权益状态 status，初始化、编辑中、审核中、上线、下线等；
5. 优先级 priority，权益也需要排序，在不接入推荐的场景中，运营可通过优先级实现权益展示顺序的调整；
6. 展示规则 displayRule，比如有些权益需要展示库存/已兑换件数，有些不需要；
7. 人群校验配置 groupCheckConfig，用户的年龄、性别、职业等属性存在差异，可针对不同人群投放不同的权益；
8. 创建者 creator，权益创建人；
9. 代理人 agents，权益的代理人，权益配置只能有创建者和代理人变更，其它人无权操作；
10. 其它，如兑换权益所需积分 point，兑换权益所需钱数 price 等省略。

经过细化和抽象得到如下模型：

![在这里插入图片描述](https://images.gitbook.cn/c436e740-780a-11ea-a98c-83821ebf98cb)

#### **4.3 业务活动向系统功能的转化**

事件的抽象、合并与细化，对粗粒的平台服务进行细化（可以直接细化到单个实体的 CRUD），然后对多个业务场景对应的相似平台服务进行合并。对于会员，可以得到如下结果：

![在这里插入图片描述](https://images.gitbook.cn/fbf17ef0-780c-11ea-82ab-e5e139c28a1e)

### 5. 物理模型设计

物理模型是在逻辑模型设计的基础上，结合具体使用的数据库管理系统，加入对系统实现的考虑，包括系统的可实现性、系统的性能等。从实现的角度，在逻辑模型的基础上做必要的反向规范化的设计、模型物理结构的设计，加入程序控制和动作控制。

作为举例，会员权益模型本身比较简单，在此直接给出会员权益物理模型，如下所示：

![在这里插入图片描述](https://images.gitbook.cn/214d0210-7816-11ea-9105-57164a9a27ea)

### 6. 总结

模型设计是一个从整体到局部、从具体到抽象，自上而下设计、自下而上验证并不断迭代完善的过程。模型设计是软件系统设计中极为关键的环节，因此，掌握模型设计方法论尤为必要。本文中，笔者以会员权益为例，分别介绍了概念分析、逻辑设计和物理设计。